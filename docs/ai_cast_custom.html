<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DIVINA: customize</title>
<link rel="icon" type="image/svg+xml" href="icon/No49.svg">
<link rel="apple-touch-icon" sizes="180x180" href="icon/No49.png">
<link rel="preload" href="./assets/fonts/NotoSerifCJKkr-Semibold-iching.woff2" as="font" type="font/woff2" crossorigin>
<style>
  @font-face{
  font-family:"NotoSerifCJK-ICHING";
  src:url("./assets/fonts/NotoSerifCJKkr-Semibold-iching.woff2") format("woff2");
  font-weight:600; font-style:normal; font-display:swap;
}
h1{ font-family:"NotoSerifCJK-ICHING","Source Han Serif K",serif; font-weight:600;text-align:center;margin-top:46px;margin-bottom:30px}
.title .han{ font-family:"NotoSerifCJK-ICHING","Source Han Serif K",serif; }
  
  :root{
    --bg:#0c111b; --card:#111a2b; --border:#22304a; --ink:#eaf0ff;
    --muted:#a8b6d7; --accent:#2b8cff; --yang:#e7eefc; --yin:#e7eefc; --mark:#ff6b6b;
    --hexWidth: 192px; --lineHeight: 24px; --rowGap: 12px; --yinGap: 26px;
    --contentMax: 1200px;
    --cardW: 400px; --cardGap: 18px; /* more compact cards */
    --metaCol1: 40px; --metaCol2: 80px; --metaCol3: 50px; --metaCol4: 100px; --metaCol5: 58px; /* tighter grid */
          /* === Brand size knobs === */
        --brandLogoSize: 140px;      /* ë¡œê³ (ì •ì‚¬ê°) í¬ê¸° */
        --brandTypeWidth: 205px;     /* ë¡œê³ íƒ€ì…(svg ê¸€ì) ê°€ë¡œí­ */
        --brandGap: 12px;            /* ë‘˜ ì‚¬ì´ ê°„ê²© */    
  }
   
  /* ìš”ì§€(í•œ ì¤„ ìš”ì•½) */
  .hex-gist{
  font-family: "NotoSerifCJK-ICHING","Source Han Serif K",serif;
  font-weight: 600;
  font-synthesis: none;
  }
  h1,
  .page-title {                /* í˜ì´ì§€ ìµœìƒë‹¨ íƒ€ì´í‹€ì— ì“°ëŠ” í´ë˜ìŠ¤ê°€ ìˆìœ¼ë©´ ê°™ì´ */
  font-family: "NotoSerifCJK-ICHING", serif !important;
  font-weight: 600 !important;
  font-synthesis: none;      /* ê°€ì§œ ë³¼ë“œ ë°©ì§€ */
  letter-spacing:0em;     /* ì·¨í–¥ ë³´ì • */
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,'Malgun Gothic',Segoe UI,Roboto,sans-serif}
  a{color:inherit}
  h1{font-size:50px;text-align:center;letter-spacing:0px;margin-top:46px;margin-bottom:30px}
  .wrap{max-width:var(--contentMax);margin:0 auto;padding:0 16px 40px}

  .brandWrap{
  display:flex; flex-direction:column; align-items:center;
  gap:var(--brandGap);
  margin: 25px 0 6px;          /* ìƒë‹¨ ì—¬ë°± ì¡°ì ˆ */
  }
  .brandWrap a{ display:inline-block; text-decoration:none; }
  .brandLogo{ width:var(--brandLogoSize); height:auto; }
  .brandType{ width:min(var(--brandTypeWidth), 84vw); height:auto; }

  /* ìŠ¤í¬ë¦°ë¦¬ë”/SEOìš© ìˆ¨ê¹€ í…ìŠ¤íŠ¸ */
  .sr-only{
  position:absolute !important; width:1px; height:1px; padding:0; margin:-1px;
  overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
  }
  
  .btn{background:#68313f;color:#fff;border:0;border-radius:12px;padding:14px 20px;font-weight:700;cursor:pointer;box-shadow:0 2px 10px rgba(0,0,0,.2);font-size:1.1rem}
  .btn.subtle{background:#243552;color:#cfe0ff;border:1px solid #2a3b5a}
  .row{display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap;justify-content:center}
  .card{flex:0 1 400px;max-width:480px;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.25)}
  .badge{display:inline-block;background:#1a2540;border:1px solid #2c3b58;border-radius:10px;padding:4px 10px;margin-bottom:10px}
  .title{text-align:center;margin:6px 0 16px}
  .title .han{font-size:45px;letter-spacing:1px;font-weight:700}
  .title .ko{font-size:14px;color:var(--muted);margin-top:4px}

  /* ì¹´ë“œ íƒ€ì´í‹€ì„ í´ë¦­ ê°€ëŠ¥í•œ ë§í¬ë¡œ */
  .title a{ color: inherit; text-decoration: none; }
  .title a:hover{ text-decoration: underline; text-underline-offset: 3px; }

  .hex{min-width: calc(26px + var(--hexWidth) + 26px); display:grid;grid-template-columns:26px auto 26px;row-gap:var(--rowGap);align-items:center}
  .lab{font-size:11px;color:#c2cfe9;text-align:center;padding-top:2px}
  .sp{width:26px;height:var(--lineHeight)}
  .lineWrap{position:relative;width:var(--hexWidth);height:var(--lineHeight);justify-self:center}
  .line{height:100%;border-radius:7px;background:#25324a;position:absolute;inset:0}
  .yang .line::before{content:'';position:absolute;inset:2px;background:#e7eefc;border-radius:5px;box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}
  .yin .line::before,.yin .line::after{content:'';position:absolute;top:2px;bottom:2px;width:calc(50% - (var(--yinGap)/2));background:#e7eefc;border-radius:5px;box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}
  .yin .line::before{left:2px} .yin .line::after{right:2px}
  .yin .gap{position:absolute;left:50%;top:2px;bottom:2px;transform:translateX(-50%);width:var(--yinGap);background:#111a2b;border-radius:4px;box-shadow:0 0 0 1px rgba(0,0,0,.12) inset}
  .chg::after{content:'è®Š';position:absolute;right:-8px;top:-4px;background:var(--mark);color:#fff;font-weight:700;font-size:11px;line-height:16px;padding:0 6px;border-radius:6px;box-shadow:0 1px 6px rgba(0,0,0,.3)}
  .unset .line::before{content:'';position:absolute;inset:2px;background:#162338;border-radius:5px;box-shadow:inset 0 0 0 1px rgba(0,0,0,.06)}

  .metaUnder{border-top:1px dashed #2a3b5a;margin-top:8px;padding-top:6px;text-align:center;width:100%}
  .metaRow{display:grid;grid-template-columns:40px 80px 50px 100px 58px;align-items:center;justify-items:start;column-gap:6px;margin:2px 0}
  .metaRow .lab2{color:#a9b8dc;justify-self:start;padding-right:2px}
  .metaRow .mono{font-variant-numeric:tabular-nums}
  .read{margin-top:8px;padding:8px 10px;border:1px solid #2a3b5a;border-radius:10px;background:#1b2b47}
  .read h4{margin:0 0 6px;font-size:15px;color:#cfe0ff}
  .read ul{margin:6px 0 0 18px;padding:0;line-height:1.45}
  .joint{margin-top:22px;padding:28px 28px;border:1px solid #2a3b5a;border-radius:16px;background:#0e172a;text-align:left;width:calc((2 * var(--cardW)) + var(--cardGap));margin-left:auto;margin-right:auto}
  .joint .summary{font-size:25px;font-weight:800;margin:0 0 20px;text-align:center}
  .joint .detail{font-size:17px;line-height:2.0;white-space:pre-line}
  
  .landing{font-weight:300;line-height:1.6;color:#a9b8dc;display:flex;flex-direction:column;align-items:center;text-align:center;}
  .landing .small{color:#fff;display:block;font-size:20px;font-weight:700;text-align:center}
  .landing .center{display:flex;justify-content:center}
  .intro textarea{margin:8px;max-width:500px;width:100%;min-height:140px;background:#0b1324;border:1px solid #2a3b5a;border-radius:12px;color:var(--ink);padding:14px;font-size:16px}
  
  .qWrap{display:flex;flex-direction:column;align-items:center;gap:10px}
  .qWrap textarea{width:min(780px, 92vw);min-height:90px;background:#0f1a2d;color:var(--ink);border:1px solid var(--border);border-radius:12px;padding:10px 12px;font-size:16px;line-height:1.5}

  .customUI{
  display:grid;
  grid-template-columns:max-content max-content;
  gap:12px;
  width:max-content;
  margin:10px auto 0;
  justify-content:center;
  }
  .selCol{
  position:relative; z-index:2;
  display:grid;
  grid-template-rows:repeat(6, var(--lineHeight));
  row-gap:var(--rowGap);
  justify-items:end;
  }
  .selCol select{width:var(--selW);min-width:var(--selW);max-width:var(--selW);background:#13233d;color:#e9f0ff;border:1px solid #2b3b5b;border-radius:8px;height:var(--lineHeight);font-size:13px;text-align-last:center;-moz-text-align-last:center}
  .prevCol{ position:relative; z-index:1; pointer-events:none;}
    .prevCol .hex{ grid-template-columns:26px auto 0 !important; }
    .prevCol .lab{ grid-column: 1;text-align:center}
  .warn{color:#f52059;font-weight:400;margin-top:10px;margin-bottom:10px}
  .hidden{display:none !important;}

  .panel{display:grid;grid-template-columns:auto;gap:10px;align-items:center;justify-items:center}
  .hex{display:grid;grid-template-columns:26px auto 26px;row-gap:var(--rowGap);align-items:center}
  .lab{text-align:center;font-size:11px;color:#c2cfe9;padding-top:2px}
  
  .gist{margin:10px 0 8px;text-align:center}
  .gist .gistLabel{font-size:14px;color:#9fb1d4;margin-bottom:4px}
  .gist .gistText{font-size:26px;font-family:"NotoSerifCJK-ICHING","Source Han Serif K",serif; font-weight:600; }
  @media (max-width:560px){ .gist .gistText{font-size:22px} }
    
  .ai{margin-top:18px;padding:18px;border:1px dashed #2a3b5a;border-radius:12px;background:#0f1a2d}
  .ai h4{margin:0 0 8px}

  @media (max-width: 560px){
    .customUI{grid-template-columns:auto 1fr;gap:10px}
    .selCol select{font-size:12px}
  }
  
  @media (max-width:940px){
    .card{flex-basis:100%;max-width:480px}
    .joint{width:auto}
  }

  /* ---- lines reveal animation (coinsì™€ ë™ì¼) ---- */
#baseHex .lineWrap .line,
#mutHex  .lineWrap .line{
  transition: opacity .28s ease, transform .28s ease;
}

/* ì• ë‹ˆ ì¤‘ì—” ìˆ¨ê¹€ â€” revealed ë¶™ì€ ê²ƒë§Œ ë³´ì´ê²Œ */
#baseHex.animating .lineWrap:not(.revealed) .line,
#mutHex.animating  .lineWrap:not(.revealed) .line{
  opacity: 0;
  transform: scaleX(.92);
}

/* ê¸°ë³¸: ë°°ì§€ëŠ” í•­ìƒ ë³´ì„ */
.lineWrap.chg::after{
  opacity: 1;
  transform: none;
  transition: opacity .28s ease, transform .28s ease;
}

/* ê²°ê³¼ ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ ì¤‘ì—ë§Œ ìˆ¨ê²¼ë‹¤ê°€ revealed ë•Œ ë³´ì´ê²Œ */
#baseHex.animating .lineWrap.chg::after,
#mutHex.animating  .lineWrap.chg::after{
  opacity: 0;
  transform: translateY(-4px);
}
#baseHex.animating .lineWrap.revealed.chg::after,
#mutHex.animating  .lineWrap.revealed.chg::after{
  opacity: 1;
  transform: translateY(0);
}

/* ì‚´ì§ íŠ•ê¹€ */
@keyframes tossPulse{
  0%{transform:scaleX(.92)} 60%{transform:scaleX(1.02)} 100%{transform:scaleX(1)}
}
#baseHex.animating .lineWrap.revealed .line,
#mutHex.animating  .lineWrap.revealed .line{
  opacity:1; transform:scaleX(1); animation:tossPulse .28s ease-out;
}

/* ì¹´ë“œ/ê³µìœ í•´ì„ í…ìŠ¤íŠ¸ëŠ” ì• ë‹ˆ ëì— í•œêº¼ë²ˆì— ë‚˜íƒ€ë‚˜ê²Œ */
.card .title, .card .gist, .card .metaUnder, .card .read{ transition: opacity 1s ease, transform 1s ease; }
.card.animating .title, .card.animating .gist, .card.animating .metaUnder, .card.animating .read{ opacity:0; transform:translateY(6px); }

.joint{ transition: opacity 1s ease, transform 1s ease; }
.joint.animating{ opacity:0; transform:translateY(6px); }

/* ì²« í”„ë ˆì„ ê¹œë¹¡ì„ ë°©ì§€ìš© */
.card.prehide .title, .card.prehide .gist, .card.prehide .metaUnder, .card.prehide .read,
.joint.prehide{ opacity:0; transform:translateY(6px); transition:none !important; }

  /* joint ë‚´ë¶€ ë¡œë”© UI (ì  3ê°œ) */
.joint.loading{position:relative}
.joint .loader{display:flex;gap:8px;justify-content:center;align-items:center;padding:12px 0}
.joint .loader span{width:8px;height:8px;border-radius:50%;background:#8aa8ff;display:inline-block;animation:blip 1s infinite ease-in-out}
.joint .loader span:nth-child(2){animation-delay:.15s}
.joint .loader span:nth-child(3){animation-delay:.3s}
@keyframes blip{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}

/* rotating-square loader (scoped) */
.joint .loader svg{ display:inline-block; }
.joint .loader .sq-outer,
.joint .loader .sq-mid,
.joint .loader .sq-inner{
  transform-box: view-box;          /* SVG transform ê¸°ì¤€ */
  transform-origin: 256px 256px;    /* viewBoxê°€ 0 0 512 512 â†’ ì¤‘ì•™ */
  will-change: transform;
}
  
  /* brandWrap ì•ˆì˜ ì‹¤ì œ ì½˜í…ì¸  ì˜ì—­ì€ ê°€ë¡œ 100%ë¡œ í¼ì¹˜ê¸° */
.brandWrap > #readingUI,
.brandWrap > #landingUI,
.brandWrap > #result{ 
  align-self: stretch;
  width: 100%;
}

  /* brandWrap ìì‹ì€ ê¸°ë³¸ ê°€ë¡œë¡œ ëŠ˜ë¦¬ê³ , ë¡œê³ (anchor)ë§Œ ê°€ìš´ë° ì •ë ¬ */
.brandWrap{ align-items: stretch; }
.brandWrap > a{ align-self: center; }  /* ë¡œê³  ë§í¬ë§Œ ê°€ìš´ë° */

  /* 1) brandWrap ìì‹ì€ ê¸°ë³¸ ê°€ë¡œë¡œ ëŠ˜ë¦¬ê³ , ë¡œê³ (anchor)ë§Œ ê°€ìš´ë° */
.brandWrap{ align-items: stretch; }
.brandWrap > a{ align-self: center; }  /* ë¡œê³  ë§í¬ë§Œ ê°€ìš´ë° ì •ë ¬ */

/* 2) ì„¹ì…˜/ë””ë¸Œ ë¸”ë¡ë“¤ì€ í­ì„ ë¶€ëª¨(.wrap)ê¹Œì§€ ê½‰ ì±„ìš°ê¸° */
.brandWrap > section,
.brandWrap > div{
  width: 100%;
  align-self: stretch;
}

/* 3) ì»¤ìŠ¤í…€ í˜ì´ì§€ ê²°ê³¼ ì„¹ì…˜ì´ í˜¹ì‹œ ë§¤ì¹­ ì•ˆ ë  ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ì§ì ‘ íƒ€ê²Ÿ */
.brandWrap > #result{ width:100%; align-self:stretch; }

/* 4) ìµœí›„ ë³´ê°•: .row ìì²´ì— ìµœëŒ€í­ì„ ì§€ì •í•´ ì¤‘ì•™ ì •ë ¬(ë¶€ëª¨ í­ ê³„ì‚°ì´ ê¼¬ì—¬ë„ ì˜†ë°°ì¹˜ ë˜ê²Œ) */
#result .row{
  max-width: var(--contentMax, 1200px);
  margin-left:auto;
  margin-right:auto;
}

/* ìˆœì°¨ ë“±ì¥: ê¸°ë³¸ ìƒíƒœ(ìˆ¨ê¹€) + í•­ìƒ transition ì ìš© */
.js-reveal,
[data-reveal-group] > * {
  opacity: 0;
  transform: translateY(8px);
  filter: blur(2px);
  transition: opacity .6s ease, transform .6s ease, filter .6s ease;
  will-change: opacity, transform, filter;
}

/* ë³´ì¼ ë•Œ */
.js-reveal.show,
[data-reveal-group] > *.show {
  opacity: 1;
  transform: translateY(0);
  filter: blur(0);
}

/* ëª¨ì…˜ ì €ê° ì‚¬ìš©ìì˜ ê²½ìš°:
   - ì´ë™/ë¸”ëŸ¬ë§Œ ì œê±° (ê¹œë¹¡ì„ ìµœì†Œí™”)
   - transitionì€ ë„ì§€ë§Œ, opacityëŠ” ê¸°ë³¸ 0ì„ ìœ ì§€ â†’ JSë¡œ ìˆœì°¨ ë…¸ì¶œì€ ê·¸ëŒ€ë¡œ */
/*@media (prefers-reduced-motion: reduce) {
  .js-reveal,
  [data-reveal-group] > * {
    transform: none !important;
    filter: none !important;
    transition: none !important;
  }
}*/
  
</style>
</head>
<body>
<div class="wrap">
  <!-- ì‹œë©˜í‹±/SEO ìœ ì§€ë¥¼ ìœ„í•œ ìˆ¨ê¹€ h1 -->
  <h1 class="sr-only">Divina Studio</h1>
  <!-- ë¸Œëœë“œ ë¸”ë¡: ìœ„ ë¡œê³ , ì•„ë˜ ë¡œê³ íƒ€ì… -->
  <div class="brandWrap">
  <!-- ë¡œê³ : í´ë¦­ ì‹œ index.html ì´ë™ -->
  <a href="index.html" aria-label="Divina Studio Home">
    <img src="./icon/No49.svg" alt="Divina logo" class="brandLogo">
  </a>

  <!-- ëœë”©: ì§ˆë¬¸ + (ì¢Œ)ì„ íƒ / (ìš°)ë³¸ê´˜ ë¯¸ë¦¬ë³´ê¸° -->
  <section id="landingUI" class="intro landing js-reveal">
    <p>ìƒí™©ê³¼ ì§ˆë¬¸ì„ ìƒì„¸íˆ ì…ë ¥í•´ ì£¼ì„¸ìš”.<br>ë¯¸ì…ë ¥ ì‹œ ê¸°ë³¸ ì ê´˜ í•´ì„ë§Œ ì œê³µë©ë‹ˆë‹¤.<br></p>
    <label class="small js-reveal" for="userQuestion">ì§ˆë¬¸ ì…ë ¥</label>
    <textarea class="js-reveal" id="userQuestion" placeholder="ì˜ˆ: ì´ë²ˆ ì´ì§ ì œì•ˆì´ ë‚´ê²Œ ìœ ë¦¬í• ê¹Œ? ì—°ë´‰ í˜‘ìƒì—ì„œ ìœ ì˜ì ì€?"></textarea>
    <div class="center js-reveal" style="margin-top:10px;margin-bottom:20px">

    <div id="customUI" class="customUI">
      <!-- (ì¢Œ) ì„ íƒë€: ì •ì  6ê°œ(6â†’1íš¨) -->
      <div class="selCol" id="selCol">
        <select data-idx="5"><option value="">ì„ íƒ</option><option value="6">ë…¸ìŒ</option><option value="7">ì†Œì–‘</option><option value="8">ì†ŒìŒ</option><option value="9">ë…¸ì–‘</option></select>
        <select data-idx="4"><option value="">ì„ íƒ</option><option value="6">ë…¸ìŒ</option><option value="7">ì†Œì–‘</option><option value="8">ì†ŒìŒ</option><option value="9">ë…¸ì–‘</option></select>
        <select data-idx="3"><option value="">ì„ íƒ</option><option value="6">ë…¸ìŒ</option><option value="7">ì†Œì–‘</option><option value="8">ì†ŒìŒ</option><option value="9">ë…¸ì–‘</option></select>
        <select data-idx="2"><option value="">ì„ íƒ</option><option value="6">ë…¸ìŒ</option><option value="7">ì†Œì–‘</option><option value="8">ì†ŒìŒ</option><option value="9">ë…¸ì–‘</option></select>
        <select data-idx="1"><option value="">ì„ íƒ</option><option value="6">ë…¸ìŒ</option><option value="7">ì†Œì–‘</option><option value="8">ì†ŒìŒ</option><option value="9">ë…¸ì–‘</option></select>
        <select data-idx="0"><option value="">ì„ íƒ</option><option value="6">ë…¸ìŒ</option><option value="7">ì†Œì–‘</option><option value="8">ì†ŒìŒ</option><option value="9">ë…¸ì–‘</option></select>
      </div>

      <!-- (ìš°) ë³¸ê´˜ ë¯¸ë¦¬ë³´ê¸°: ê¸°ë³¸ ë¯¸ì„ íƒ ìƒíƒœ -->
      <div class="prevCol">
        <div class="hex" id="prevBaseHex">
          <div class="lab">6</div><div class="lineWrap unset"><div class="line"></div></div>
          <div class="lab">5</div><div class="lineWrap unset"><div class="line"></div></div>
          <div class="lab">4</div><div class="lineWrap unset"><div class="line"></div></div>
          <div class="lab">3</div><div class="lineWrap unset"><div class="line"></div></div>
          <div class="lab">2</div><div class="lineWrap unset"><div class="line"></div></div>
          <div class="lab">1</div><div class="lineWrap unset"><div class="line"></div></div>
        </div>
      </div>
    </div>
    </div>
    <div id="msg" class="warn hidden">ì ê´˜ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>

    <div style="display:flex;justify-content:center;margin-top:14px;gap:10px">
      <button id="btnRun" class="btn js-reveal">ì œì¶œ ë° ì ê´˜ ì‹¤í–‰</button>
    </div>
  </section>

  <!-- ê²°ê³¼ -->
  <section id="result" class="hidden">
    <div class="row">
      <div class="card" id="cardBase">
        <div class="badge">ë³¸ê´˜</div>
        <div class="title" id="baseTitle"></div>
        <div class="panel" id="panelBase">        
          <div class="hex" id="baseHex"></div>
          <div class="gist" id="basegist"></div>
          <div class="metaUnder" id="baseMeta"></div>
        </div>
        <div class="read" id="baseRead"></div>
      </div>
      <div class="card" id="cardMut">
        <div class="badge">ë³€ê´˜</div>
        <div class="title" id="mutTitle"></div>
        <div class="panel" id="panelMut">        
          <div class="hex" id="mutHex"></div>
          <div class="gist" id="mutgist"></div>
          <div class="metaUnder" id="mutMeta"></div>
        </div>
        <div class="read" id="mutRead"></div>
      </div>
    </div>

  <div class="joint" id="jointBox">
    <div class="summary" id="jointSummary">í•´ì„ ì¤€ë¹„ì¤‘â€¦</div>
    <div class="detail" id="jointText"></div>
  </div>

    <div style="display:flex;justify-content:center;margin-top:18px">
      <a class="btn subtle" href="index.html">ëŒì•„ê°€ê¸°</a>
    </div>
  </section>

  <div class="legend" style="text-align:center;margin-top:18px;font-size:12px;color:#a4b2d4">Â© 2025. å¦™å…¬ (Myo Gong). All Rights Reserved.</div>
</div>

<pre id="dbg" style="display:none;position:fixed;right:10px;bottom:10px;max-width:46vw;background:#111a2a;color:#e7efff;border:1px solid #2e3c5a;border-radius:10px;padding:10px 12px;font:12px/1.5 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;z-index:9999;white-space:pre-wrap"></pre>
<script>
const dbg=document.getElementById('dbg');
function log(){ dbg.style.display='block'; dbg.textContent += Array.from(arguments).join(' ') + "\n"; }
window.addEventListener('keydown',e=>{ if(e.shiftKey && e.key.toLowerCase()==='d'){ dbg.style.display = (dbg.style.display==='none'?'block':'none'); }});
</script>

<script>

  /* --- overrides loader (coinsì™€ ë™ì¼) --- */
(function(){
  const OVERRIDES_BASE_PATH = './overrides';
  const BUILD_VERSION = 'v2'; // ìºì‹œ ê°±ì‹ ìš©

  const pad2 = n => String(n).padStart(2, '0');

  async function __overrideLoad(baseNo, targetNo){
    const url = `${OVERRIDES_BASE_PATH}/overrides_base_${pad2(baseNo)}_domains.json?v=${BUILD_VERSION}`;
    try{
      const res = await fetch(url);
      if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json();
      return data[String(targetNo)] || null;   // ì—†ìœ¼ë©´ null
    }catch(e){
      console.warn('override fetch fail', e);
      return null;
    }
  }
  // ì „ì—­ ë…¸ì¶œ(ì•ˆì „ ë²”ìœ„)
  window.__overrideLoad = __overrideLoad;
})();

/* ë¼ë²¨ ì œê±° ìœ í‹¸(ë™ì „ë²•ê³¼ ë™ì¼) */
function stripLabelsInline(t){
  // ìš”ì•½ í•œ ì¤„ì—ì„œ " Â· í•µì‹¬: â€¦", " Â· ìƒì„¸: â€¦" ê¼¬ë¦¬ ì œê±°
  return (t||'').replace(/\s*[Â·â€¢]?\s*(í•µì‹¬|ìƒì„¸)\s*:\s*[^\n\r]*/g, '')
                .replace(/\s{2,}/g,' ')
                .trim();
}
function stripLabelsInDetail(t){
  // ë³¸ë¬¸ì—ì„œ "í•µì‹¬:" ì¤„ì€ í†µì§¸ë¡œ ì œê±°, "ìƒì„¸:"ëŠ” ë¼ë²¨ë§Œ ì§€ìš°ê³  ë’¤ ë‚´ìš© ë³´ì¡´
  if(!t) return '';
  return t.split(/\r?\n/).map(l=>{
    if(/^\s*[Â·â€¢]?\s*í•µì‹¬\s*:/.test(l)) return '';
    return l.replace(/^\s*[Â·â€¢]?\s*ìƒì„¸\s*:\s*/, '');
  }).filter(Boolean).join('\n');
}
  
/******** ë°ì´í„° & ìœ í‹¸ ********/
const TRIS=['å¤','éœ‡','å','å…Œ','è‰®','é›¢','å·½','ä¹¾'];
const TRIS_KO={'å¤':'ê³¤','éœ‡':'ì§„','å':'ê°','è‰®':'ê°„','å·½':'ì†','é›¢':'ë¦¬','å…Œ':'íƒœ','ä¹¾':'ê±´'};
const TRI_MEAN_HAN={'ä¹¾':'å¤©','å¤':'åœ°','å':'æ°´','é›¢':'ç«','éœ‡':'é›·','å·½':'é¢¨','è‰®':'å±±','å…Œ':'æ¾¤'};
const TRI_ATTR_KO={'ä¹¾':'ì²œ','å¤':'ì§€','å':'ìˆ˜','é›¢':'í™”','éœ‡':'ë‡Œ','å·½':'í’','è‰®':'ì‚°','å…Œ':'íƒ'};
const TRI_META={"ä¹¾":{"attrHan":"å¤©","attrKo":"ì²œ","elem":"é‡‘","meaning":"ê¶Œìœ„Â·ê²°ë‹¨","dir":"ì„œë¶","arrow":"â†–"},"å¤":{"attrHan":"åœ°","attrKo":"ì§€","elem":"åœŸ","meaning":"ìˆ˜ìš©Â·ì–‘ìœ¡","dir":"ì„œë‚¨","arrow":"â†™"},"å":{"attrHan":"æ°´","attrKo":"ìˆ˜","elem":"æ°´","meaning":"ì‹¬ì—°Â·ìœ„í—˜","dir":"ë¶","arrow":"â†‘"},"é›¢":{"attrHan":"ç«","attrKo":"í™”","elem":"ç«","meaning":"ë¹›Â·ë¶„ë³„","dir":"ë‚¨","arrow":"â†“"},"éœ‡":{"attrHan":"é›·","attrKo":"ë‡Œ","elem":"æœ¨","meaning":"ê°ì„±Â·ì‹œì‘","dir":"ë™","arrow":"â†’"},"å·½":{"attrHan":"é¢¨","attrKo":"í’","elem":"æœ¨","meaning":"ì¹¨íˆ¬Â·í™•ì‚°","dir":"ë™ë‚¨","arrow":"â†˜"},"è‰®":{"attrHan":"å±±","attrKo":"ì‚°","elem":"åœŸ","meaning":"ë©ˆì¶¤Â·ê²½ê³„","dir":"ë™ë¶","arrow":"â†—"},"å…Œ":{"attrHan":"æ¾¤","attrKo":"íƒ","elem":"é‡‘","meaning":"ê¸°ì¨Â·êµë¥˜","dir":"ì„œ","arrow":"â†"}};
const META={"uä¹¾lä¹¾":{"no":1,"nameHan":"ä¹¾","nameKo":"ê±´","upper":"ä¹¾","lower":"ä¹¾","summary":"ì°½ì¡°ì™€ ì‹œì‘, ê°•ê±´í•œ ì¶”ì§„ë ¥"},"uå¤lå¤":{"no":2,"nameHan":"å¤","nameKo":"ê³¤","upper":"å¤","lower":"å¤","summary":"í¬ìš©ê³¼ ìˆœì‘, ë„“ì€ ìˆ˜ìš©ë ¥"},"uåléœ‡":{"no":3,"nameHan":"å±¯","nameKo":"ë‘”","upper":"å","lower":"éœ‡","summary":"ì´ˆê¸° ë‚œê´€, ì¸ë‚´ë¡œ ë°©í–¥ì„ ì¡ì•„ë¼"},"uè‰®lå":{"no":4,"nameHan":"è’™","nameKo":"ëª½","upper":"è‰®","lower":"å","summary":"ë¯¸ë¥ì§€ ëª»í•¨, ë°°ì›€ê³¼ ê¸¸ì¡ì´ í•„ìš”"},"uålä¹¾":{"no":5,"nameHan":"éœ€","nameKo":"ìˆ˜","upper":"å","lower":"ä¹¾","summary":"ë•Œë¥¼ ê¸°ë‹¤ë¦¼, ì¤€ë¹„ëœ ì¸ë‚´"},"uä¹¾lå":{"no":6,"nameHan":"è¨Ÿ","nameKo":"ì†¡","upper":"ä¹¾","lower":"å","summary":"ë‹¤íˆ¼ê³¼ ë…¼ìŸ, ì›ì¹™ê³¼ ì ˆì œê°€ í•´ë²•"},"uå¤lå":{"no":7,"nameHan":"å¸«","nameKo":"ì‚¬","upper":"å¤","lower":"å","summary":"ì¡°ì§ê³¼ ê·œìœ¨, ë¦¬ë”ì‹­ì´ í•„ìš”"},"uålå¤":{"no":8,"nameHan":"æ¯”","nameKo":"ë¹„","upper":"å","lower":"å¤","summary":"ê²°í•©ê³¼ ì¹œí™”, ì‹ ì˜ ì§€í‚¤ê¸°"},"uå·½lä¹¾":{"no":9,"nameHan":"å°ç•œ","nameKo":"ì†Œì¶•","upper":"å·½","lower":"ä¹¾","summary":"ì‘ê²Œ ëª¨ì•„ í˜ì„ ê¸°ë¥´ëŠ” ë•Œ"},"uä¹¾lå…Œ":{"no":10,"nameHan":"å±¥","nameKo":"ë¦¬","upper":"ä¹¾","lower":"å…Œ","summary":"ì˜ˆì ˆê³¼ ì ˆë„ ì†ì˜ ì „ì§„"},"uå¤lä¹¾":{"no":11,"nameHan":"æ³°","nameKo":"íƒœ","upper":"å¤","lower":"ä¹¾","summary":"ì†Œí†µê³¼ ìƒìƒ, í˜•í†µí•¨"},"uä¹¾lå¤":{"no":12,"nameHan":"å¦","nameKo":"ë¹„","upper":"ä¹¾","lower":"å¤","summary":"ë§‰í˜ê³¼ ë‹¨ì ˆ, ì ‘ì´‰ë©´ì„ ë„“í˜€ë¼"},"uä¹¾lé›¢":{"no":13,"nameHan":"åŒäºº","nameKo":"ë™ì¸","upper":"ä¹¾","lower":"é›¢","summary":"ê³µë™ì²´ì™€ ì—°ëŒ€, ëœ»ì„ í•¨ê»˜í•¨"},"ué›¢lä¹¾":{"no":14,"nameHan":"å¤§æœ‰","nameKo":"ëŒ€ìœ ","upper":"é›¢","lower":"ä¹¾","summary":"í’ìš”ì™€ ì„±ì·¨, ëª…ì„±ê³¼ ì†Œìœ "},"uå¤lè‰®":{"no":15,"nameHan":"è¬™","nameKo":"ê²¸","upper":"å¤","lower":"è‰®","summary":"ê²¸ì†ê³¼ ì ˆì œ, ë‚®ì„ìˆ˜ë¡ ë‹¨ë‹¨í•˜ë‹¤"},"uéœ‡lå¤":{"no":16,"nameHan":"è±«","nameKo":"ì˜ˆ","upper":"éœ‡","lower":"å¤","summary":"ì¦ê±°ìš´ ì¤€ë¹„, ê¸°íšê³¼ ì˜ˆë¹„"},"uå…Œléœ‡":{"no":17,"nameHan":"éš¨","nameKo":"ìˆ˜","upper":"å…Œ","lower":"éœ‡","summary":"ë”°ë¦„ê³¼ ìˆœì‘, ìœ ì—°í•œ ì „í™˜"},"uè‰®lå·½":{"no":18,"nameHan":"è ±","nameKo":"ê³ ","upper":"è‰®","lower":"å·½","summary":"íë‹¨ì„ ê³ ì¹˜ê³  ê¸°ë°˜ì„ ìˆ˜ë¦¬í•˜ë¼"},"uå¤lå…Œ":{"no":19,"nameHan":"è‡¨","nameKo":"ì„","upper":"å¤","lower":"å…Œ","summary":"ë‹¤ê°€ê°Â·ì ‘ê·¼, ìƒí˜¸ì„±"},"uå·½lå¤":{"no":20,"nameHan":"è§€","nameKo":"ê´€","upper":"å·½","lower":"å¤","summary":"ê´€ì°°ê³¼ í†µì°°, í° ê·¸ë¦¼ ë³´ê¸°"},"ué›¢léœ‡":{"no":21,"nameHan":"å™¬å—‘","nameKo":"ì„œí•©","upper":"é›¢","lower":"éœ‡","summary":"ê²°ë‹¨ê³¼ ì§‘í–‰, ì•…ì„ ì”¹ì–´ ì—†ì• ë¼"},"uè‰®lé›¢":{"no":22,"nameHan":"è³","nameKo":"ë¹„","upper":"è‰®","lower":"é›¢","summary":"ì¹˜ì¥ê³¼ í‘œí˜„, ì•„ë¦„ë‹¤ì›€ì˜ ë°°ì¹˜"},"uè‰®lå¤":{"no":23,"nameHan":"å‰","nameKo":"ë°•","upper":"è‰®","lower":"å¤","summary":"ê¹ì—¬ ë‚˜ê°, ì‡ í‡´ ì† ì „í™˜ ì¤€ë¹„"},"uå¤léœ‡":{"no":24,"nameHan":"å¾©","nameKo":"ë³µ","upper":"å¤","lower":"éœ‡","summary":"ë˜ëŒì•„ì˜´, íšŒë³µê³¼ ì¬ê¸°ì˜ ì‹œì‘"},"uä¹¾léœ‡":{"no":25,"nameHan":"ç„¡å¦„","nameKo":"ë¬´ë§","upper":"ä¹¾","lower":"éœ‡","summary":"ì‚¬ì‹¬ ì—†ìŒ, ìì—°ìŠ¤ëŸ¬ì›€ì´ ê¸¸"},"uè‰®lä¹¾":{"no":26,"nameHan":"å¤§ç•œ","nameKo":"ëŒ€ì¶•","upper":"è‰®","lower":"ä¹¾","summary":"í° ê¸¸ë“¤ì„, ì¶•ì ê³¼ ìì œ"},"uè‰®léœ‡":{"no":27,"nameHan":"é ¤","nameKo":"ì´","upper":"è‰®","lower":"éœ‡","summary":"ì–‘ìœ¡ê³¼ ì„­ìƒ, ë§ ì¡°ì‹¬"},"uå…Œlå·½":{"no":28,"nameHan":"å¤§é","nameKo":"ëŒ€ê³¼","upper":"å…Œ","lower":"å·½","summary":"ì§€ë‚˜ì¹¨, ê³¼ë¶€í•˜ë¥¼ ë°”ë¡œì¡ì•„ë¼"},"uålå":{"no":29,"nameHan":"å","nameKo":"ê°","upper":"å","lower":"å","summary":"í—˜ë‚œÂ·ë°˜ë³µ ì† ì²´ë“"},"ué›¢lé›¢":{"no":30,"nameHan":"é›¢","nameKo":"ë¦¬","upper":"é›¢","lower":"é›¢","summary":"ë¹›ê³¼ ëª…ë£Œ, ì˜ì§€ë¥¼ ë¶™ë“¤ë¼"},"uå…Œlè‰®":{"no":31,"nameHan":"å’¸","nameKo":"í•¨","upper":"å…Œ","lower":"è‰®","summary":"ê°ì‘ê³¼ ëŒë¦¼, ìƒí˜¸ ë§¤ë ¥"},"uéœ‡lå·½":{"no":32,"nameHan":"æ†","nameKo":"í•­","upper":"éœ‡","lower":"å·½","summary":"ì§€ì†ê³¼ ì§€ì¡°, ê¾¸ì¤€í•¨"},"uä¹¾lè‰®":{"no":33,"nameHan":"é¯","nameKo":"ë‘”","upper":"ä¹¾","lower":"è‰®","summary":"ë¬¼ëŸ¬ë‚¨, ë•Œë¥¼ ê¸°ë‹¤ë¦¬ëŠ” í‡´ê°"},"uéœ‡lä¹¾":{"no":34,"nameHan":"å¤§å£¯","nameKo":"ëŒ€ì¥","upper":"éœ‡","lower":"ä¹¾","summary":"í° í˜ì˜ ë°œíœ˜, ë¬´ë¦¬í•˜ì§€ ë§ë¼"},"ué›¢lå¤":{"no":35,"nameHan":"æ™‰","nameKo":"ì§„","upper":"é›¢","lower":"å¤","summary":"ì „ì§„Â·ìŠ¹ì§„, ë‚®ì—ì„œ ë†’ìœ¼ë¡œ"},"uå¤lé›¢":{"no":36,"nameHan":"æ˜å¤·","nameKo":"ëª…ì´","upper":"å¤","lower":"é›¢","summary":"ë¹›ì´ ìƒí•¨, ìˆ¨ê³  ë³´ì¡´í•˜ë¼"},"uå·½lé›¢":{"no":37,"nameHan":"å®¶äºº","nameKo":"ê°€ì¸","upper":"å·½","lower":"é›¢","summary":"ê°€ì •ê³¼ ì—­í•  ì§ˆì„œ"},"ué›¢lå…Œ":{"no":38,"nameHan":"ç½","nameKo":"ê·œ","upper":"é›¢","lower":"å…Œ","summary":"ì—‡ê°ˆë¦¼ê³¼ ë¶ˆí™”, ì°¨ì´ì˜ ì¸ì •"},"uålè‰®":{"no":39,"nameHan":"è¹‡","nameKo":"ê±´","upper":"å","lower":"è‰®","summary":"ë‚œê´€Â·ì§€ì²´, ìš°íšŒí•˜ë¼"},"uéœ‡lå":{"no":40,"nameHan":"è§£","nameKo":"í•´","upper":"éœ‡","lower":"å","summary":"í’€ë¦¼ê³¼ í•´ê²°, ì‚¬ë©´"},"uè‰®lå…Œ":{"no":41,"nameHan":"æ","nameKo":"ì†","upper":"è‰®","lower":"å…Œ","summary":"ê°ì†ŒÂ·ë¹„ì›€, ìë°œì  ì ˆì œ"},"uå·½léœ‡":{"no":42,"nameHan":"ç›Š","nameKo":"ìµ","upper":"å·½","lower":"éœ‡","summary":"ì¦ê°€Â·ë³´ìƒ, ë„ì›€ ì£¼ê³  ë°›ê¸°"},"uå…Œlä¹¾":{"no":43,"nameHan":"å¤¬","nameKo":"ì¾Œ","upper":"å…Œ","lower":"ä¹¾","summary":"ë‹¨í˜¸í•œ ê²°ë‹¨ì˜ ì„ í¬"},"uä¹¾lå·½":{"no":44,"nameHan":"å§¤","nameKo":"êµ¬","upper":"ä¹¾","lower":"å·½","summary":"ëœ»ë°–ì˜ ë§Œë‚¨, ê²½ê³„ ìœ ì§€"},"uå…Œlå¤":{"no":45,"nameHan":"èƒ","nameKo":"ì·Œ","upper":"å…Œ","lower":"å¤","summary":"ëª¨ì„Â·ìˆ˜í•©, ë™ì›"},"uå¤lå·½":{"no":46,"nameHan":"å‡","nameKo":"ìŠ¹","upper":"å¤","lower":"å·½","summary":"ì˜¤ë¦„Â·ìŠ¹ì§„, ì ì§„ì  ì„±ì¥"},"uå…Œlå":{"no":47,"nameHan":"å›°","nameKo":"ê³¤","upper":"å…Œ","lower":"å","summary":"ê³¤ê¶Â·ì••ë°•, ë‚´ì  í˜"},"uålå·½":{"no":48,"nameHan":"äº•","nameKo":"ì •","upper":"å","lower":"å·½","summary":"ìš°ë¬¼Â·ìì›, ê³µìµê³¼ ì¬ë¶„ë°°"},"uå…Œlé›¢":{"no":49,"nameHan":"é©","nameKo":"í˜","upper":"å…Œ","lower":"é›¢","summary":"ë³€í˜ê³¼ íƒˆí”¼, ìƒˆ ì§ˆì„œ"},"ué›¢lå·½":{"no":50,"nameHan":"é¼","nameKo":"ì •","upper":"é›¢","lower":"å·½","summary":"ì†¥Â·ì¡°ë¦¬, í”„ë¡œì íŠ¸ ì™„ì„±"},"uéœ‡léœ‡":{"no":51,"nameHan":"éœ‡","nameKo":"ì§„","upper":"éœ‡","lower":"éœ‡","summary":"ì¶©ê²©ê³¼ ê°ì„±, ì‹œì‘ì˜ ìš°ë ˆ"},"uè‰®lè‰®":{"no":52,"nameHan":"è‰®","nameKo":"ê°„","upper":"è‰®","lower":"è‰®","summary":"ê·¸ì¹¨Â·ë©ˆì¶¤, ëª…ìƒê³¼ ê²½ê³„"},"uå·½lè‰®":{"no":53,"nameHan":"æ¼¸","nameKo":"ì ","upper":"å·½","lower":"è‰®","summary":"ì ì§„Â·ì„œì„œíˆ ì„±ìˆ™"},"uéœ‡lå…Œ":{"no":54,"nameHan":"æ­¸å¦¹","nameKo":"ê·€ë§¤","upper":"éœ‡","lower":"å…Œ","summary":"ë¶ˆê· í˜•í•œ ê²°í•©, ì„ì‹œì  ë™ë§¹"},"uéœ‡lé›¢":{"no":55,"nameHan":"è±","nameKo":"í’","upper":"éœ‡","lower":"é›¢","summary":"í’ìš”ì˜ ì ˆì •, ê°€ì‹œì„±"},"ué›¢lè‰®":{"no":56,"nameHan":"æ—…","nameKo":"ì—¬","upper":"é›¢","lower":"è‰®","summary":"ë‚˜ê·¸ë„¤, ì„ì‹œÂ·ê²½ê³„ ì§€í‚¤ê¸°"},"uå·½lå·½":{"no":57,"nameHan":"å·½","nameKo":"ì†","upper":"å·½","lower":"å·½","summary":"ìŠ¤ë©°ë“¦, ì ì§„ ì¹¨íˆ¬"},"uå…Œlå…Œ":{"no":58,"nameHan":"å…Œ","nameKo":"íƒœ","upper":"å…Œ","lower":"å…Œ","summary":"ê¸°ì¨ê³¼ ì—´ë¦° êµë¥˜"},"uå·½lå":{"no":59,"nameHan":"æ¸™","nameKo":"í™˜","upper":"å·½","lower":"å","summary":"í©ì–´ì§Â·ë¶„ì‚°, ì •í™”"},"uålå…Œ":{"no":60,"nameHan":"ç¯€","nameKo":"ì ˆ","upper":"å","lower":"å…Œ","summary":"ê·œë²”Â·ì ˆì œ, í•œì •"},"uå·½lå…Œ":{"no":61,"nameHan":"ä¸­å­š","nameKo":"ì¤‘ë¶€","upper":"å·½","lower":"å…Œ","summary":"ì„±ì‹¤Â·ì§„ì •ì„±, ë‚´ì  ì‹ ë¢°"},"uéœ‡lè‰®":{"no":62,"nameHan":"å°é","nameKo":"ì†Œê³¼","upper":"éœ‡","lower":"è‰®","summary":"ì‘ì€ ê³¼ë„, ì¡°ì‹¬ìŠ¤ëŸ° ì§„ì „"},"uålé›¢":{"no":63,"nameHan":"æ—¢æ¿Ÿ","nameKo":"ê¸°ì œ","upper":"å","lower":"é›¢","summary":"ì´ë¯¸ ê±´ë„Œ ë’¤ì˜ ìœ ì§€Â·ê´€ë¦¬"},"ué›¢lå":{"no":64,"nameHan":"æœªæ¿Ÿ","nameKo":"ë¯¸ì œ","upper":"é›¢","lower":"å","summary":"ì•„ì§ ë¯¸ì™„, ë§ˆë¬´ë¦¬ ì „ ì£¼ì˜"}};

const POS_LABEL=["1íš¨","2íš¨","3íš¨","4íš¨","5íš¨","6íš¨"];
const POS_ROLE=["(ì‹œì‘Â·ê¸°ì´ˆ)","(ê´€ê³„Â·ë‚´ì¤‘)","(ê²½ê³„Â·ìœ„í—˜)","(ìŠ¹ê²©Â·ì¶œí˜„)","(ì§€ë„Â·ì™¸ì¤‘)","(ê²°ë§Â·ê³¼í•¨)"];
const POS_DOMAIN=["ê°œì¸Â·ì¶œë°œ","ê´€ê³„Â·íŒŒíŠ¸ë„ˆ","ê²½ê³„Â·ê°ˆë“±","ì§ì¥Â·ì™¸ë¶€","ë¦¬ë”ì‹­Â·ê³µì ","ë§ˆë¬´ë¦¬Â·ê³¼ë‹¤"];

function toTriChar(bits){ return TRIS[(bits[0]) | (bits[1]<<1) | (bits[2]<<2)]; }
function lookup(hex){
  const low=toTriChar([hex[0],hex[1],hex[2]]), up=toTriChar([hex[3],hex[4],hex[5]]);
  return META['u'+up+'l'+low];
}
function makeTitle(info){
  const big   = TRI_MEAN_HAN[info.upper] + TRI_MEAN_HAN[info.lower] + info.nameHan;
  const small = 'No.' + info.no + ' ' + TRI_ATTR_KO[info.upper] + TRI_ATTR_KO[info.lower] + info.nameKo;

  const pad2  = n => String(n).padStart(2,'0');
  // ğŸ‘‰ Dict í´ë” ì•ˆ ìƒì„¸íŒŒì¼ ê²½ë¡œ (ì˜ˆ: ./Dict/hex_09_ì†Œì¶•.html)
  const href  = `./Dict/hex_${pad2(info.no)}_${encodeURIComponent(info.nameKo)}.html`;

  // íƒ€ì´í‹€ ì „ì²´ë¥¼ ë§í¬ë¡œ ê°ì‹¸ê¸°
  return `<a href="${href}" target="_blank" rel="noopener" class="titleLink">
            <div class="han">${big}</div>
            <div class="ko">${small}</div>
          </a>`;
}
function metaRow(label,tri){ const m=TRI_META[tri];
  return '<div class="metaRow">'
    +'<div class="lab2">'+label+'</div>'
    +'<div class="mono"><b>'+tri+'</b> ('+TRIS_KO[tri]+')</div>'
    +'<div class="mono">'+m.elem+'</div>'
    +'<div>'+m.meaning+'</div>'
    +'<div class="mono">'+m.arrow+' '+m.dir+'</div>'
    +'</div>';
}


function makeInterpretation(changed, vals, info){
  var k = changed.filter(Boolean).length, html = '<h4>í•´ì„</h4>';
  if (k===0){
    html += 'ë¬´ë³€(ç„¡è®Š): í˜„ìƒ ìœ ì§€.';
  } else {
    html += '<div>ë³€íš¨ '+k+'ê°œ</div><ul>';
    for (var i=0;i<6;i++){
      if (!changed[i]) continue;
      var dir = (vals[i]===6) ? 'ìŒâ†’ì–‘(â†— ê°œì‹œ)' : 'ì–‘â†’ìŒ(â†˜ ìˆ˜ë ´)';
      html += '<li>'+POS_LABEL[i]+' '+POS_ROLE[i]+' Â· '+dir+'</li>';  // â† li ë³µêµ¬
    }
    html += '</ul>';  // â† ìš”ì§€ ë¬¸ì¥ ì‚­ì œ
  }
  return html;
}


function render(prefix, hex, changed, vals, info){
  var hexBox = document.getElementById(prefix+'Hex');
  var title  = document.getElementById(prefix+'Title');
  var metaUnder = document.getElementById(prefix+'Meta');
  var readBox = document.getElementById(prefix+'Read');
  var gist  = document.getElementById(prefix+'gist');

  // 1) ë¨¼ì € ë¹„ìš°ê¸°
  if (hexBox)    hexBox.innerHTML = '';
  if (metaUnder) metaUnder.innerHTML = '';
  if (readBox)   readBox.innerHTML = '';
  if (title)     title.innerHTML = '';
  if (gist)      gist.innerHTML = '';

  // 2) ë¼ì¸ ë Œë”
  for (var r=5; r>=0; r--){
    var lab  = document.createElement('div'); lab.className='lab'; lab.textContent=(r+1);
    var wrap = document.createElement('div'); wrap.className='lineWrap '+(hex[r]?'yang':'yin')+(changed[r]?' chg':'');
    var line = document.createElement('div'); line.className='line'; wrap.appendChild(line);
    if(!hex[r]){ var gap=document.createElement('div'); gap.className='gap'; wrap.appendChild(gap); }
    if(hexBox){ hexBox.appendChild(lab); hexBox.appendChild(wrap); var sp=document.createElement('div'); sp.className='sp'; hexBox.appendChild(sp); }
  }

  // 3) ì œëª©/ë©”íƒ€/ìš”ì§€/í•´ì„ ì±„ìš°ê¸°
  if (info){
    if (title)     title.innerHTML = makeTitle(info);
    if (metaUnder) metaUnder.innerHTML = metaRow('ìƒê´˜', info.upper) + metaRow('í•˜ê´˜', info.lower);
    if (gist){
      var label = (prefix === 'base') ? 'ë³¸ê´˜ ìš”ì§€' : 'ë³€ê´˜ ìš”ì§€';
      gist.innerHTML = '<div class="gistLabel">'+label+'</div>'
                     + '<div class="gistText">'+ info.summary +'</div>';
    }
    if (readBox)   readBox.innerHTML = makeInterpretation(changed, vals, info);
  } else {
    if (title) title.textContent = 'â€”';
  }
}

  
function renderJoint(base, mutated, changed, vals, bInfo, mInfo){
  const s=document.getElementById('jointSummary');
  const d=document.getElementById('jointText');
  if(!s||!d) return;

  const k = changed.filter(Boolean).length;
  let ups=0, downs=0, posArr=[], domains=[];
  for(let i=0;i<6;i++){
    if(changed[i]){
      posArr.push((i+1)+'íš¨'); domains.push(POS_DOMAIN[i]);
      if(vals[i]===6) ups++; else downs++;
    }
  }
  const trend = (ups>downs)?'ê¸°ì„¸ê°€ ì—´ë¦¼(â†—)':(downs>ups)?'ê¸°ì„¸ê°€ ë‹«í˜(â†˜)':'ê· í˜• ì „í™˜(â†’)';

  if(k===0){
    // ê¸°ë³¸ ë¬¸êµ¬ ë¨¼ì € ì¶œë ¥
    s.textContent = 'ë³€í™” ì—†ìŒ â€” í˜„ìƒ ìœ ì§€, ë‚´ì‹¤ì„ ë‹¤ì§ˆ ë•Œ';
    d.textContent = 'í˜„ì¬ #'+bInfo.no+' '+(TRI_MEAN_HAN[bInfo.upper]+TRI_MEAN_HAN[bInfo.lower]+bInfo.nameHan)
      +'('+TRI_ATTR_KO[bInfo.upper]+TRI_ATTR_KO[bInfo.lower]+bInfo.nameKo+')ì˜ ê¸°ìš´ì´ ê³„ì†ë©ë‹ˆë‹¤.\n'
      +'ê¸‰ë³€ë³´ë‹¤ëŠ” ì•ˆì •ê³¼ ë³´ìˆ˜ì— ì´ˆì ì„ ë‘ì„¸ìš”.';

    // â¬‡ï¸ overrides (no-change) â€” ìˆìœ¼ë©´ ìš”ì•½/ë³¸ë¬¸ì„ ë®ì–´ì“°ê¸°
    try{
      window.__overrideLoad && window.__overrideLoad(bInfo.no, bInfo.no).then(ov=>{
        if(!ov) return;
        const box = document.getElementById('jointBox');
        if (box?.classList.contains('ai-owned')) return; // AIê°€ ì“°ëŠ” ì¤‘ì´ë©´ ë®ì–´ì“°ì§€ ì•ŠìŒ

        s.textContent = stripLabelsInline(ov.summary || '');

        const doms = ov.domains || {};
        const body = (stripLabelsInDetail(ov.detail || '') + '\n\n'
          + 'Â· ì—°ì• : ' + (doms['ì—°ì• '] || '') + '\n'
          + 'Â· ì‚¬ì—…: ' + (doms['ì‚¬ì—…'] || '') + '\n'
          + 'Â· ê³µë¶€: ' + (doms['ê³µë¶€'] || '') + '\n'
          + 'Â· ê±´ê°•: ' + (doms['ê±´ê°•'] || '')).trim();

        // ì•ˆì „í•˜ê²Œ êµì²´
        d.replaceChildren();
        body.split(/\n+/).filter(Boolean).forEach(p=>{
          const el=document.createElement('p'); el.textContent=p; d.appendChild(el);
        });
      });
    }catch(e){ console.warn(e); }

    return;  // â† ì—¬ê¸°ì„œ ì¢…ë£Œ (ë³€ê´˜ ë¶„ê¸°ë¡œ ë–¨ì–´ì§€ì§€ ì•Šê²Œ)
  }

  // (k>0) ê¸°ë³¸ ìš”ì•½/ë³¸ë¬¸
  s.textContent = 'ë³€íš¨ '+k+'ê°œ â€” '+trend+' Â· í•µì‹¬: '+posArr.join(', ');
  let parts=[];
  parts.push('í˜„ì¬ ë³¸ê´˜ '+bInfo.nameKo+'(#'+bInfo.no+', '+TRI_ATTR_KO[bInfo.upper]+TRI_ATTR_KO[bInfo.lower]+')ëŠ” "'+bInfo.summary+'"ì„(ë¥¼) ëœ»í•©ë‹ˆë‹¤.');
  parts.push('ë³€í™”ë¥¼ ê±°ì³ ë³€ê´˜ '+mInfo.nameKo+'(#'+mInfo.no+', '+TRI_ATTR_KO[mInfo.upper]+TRI_ATTR_KO[mInfo.lower]+')ë¡œ í–¥í•˜ë©° "'+mInfo.summary+'"ì˜ êµ­ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
  parts.push('ì´ë²ˆ ë³€í™”ëŠ” '+domains.join('Â·')+' ì˜ì—­ì—ì„œ ë‘ë“œëŸ¬ì§‘ë‹ˆë‹¤.');
  parts.push( (ups>downs)?'ë§‰íˆë˜ ê²ƒì´ ì—´ë¦¬ê±°ë‚˜ ìƒˆë¡œìš´ ì‹œì‘ì˜ ì‹ í˜¸ê°€ ê°•í•©ë‹ˆë‹¤.'
                         : (downs>ups?'ê³¼í•¨ì„ ì¤„ì´ê³  ì •ë¦¬Â·ìˆ˜ë ´í•˜ëŠ” íë¦„ì´ ìš°ì„¸í•©ë‹ˆë‹¤.'
                                   :'íŒ½íŒ½í•œ ê· í˜• ì†ì—ì„œ ë°©í–¥ ì „í™˜ì˜ ì—¬ì§€ê°€ í½ë‹ˆë‹¤.') );
  d.textContent = parts.join('\n');

  // â¬‡ï¸ overrides (changed) â€” ìˆìœ¼ë©´ ë®ì–´ì“°ê¸°
  try{
    window.__overrideLoad && window.__overrideLoad(bInfo.no, mInfo.no).then(ov=>{
      if(!ov) return;
      const box = document.getElementById('jointBox');
      if (box?.classList.contains('ai-owned')) return;  // AIê°€ ì“°ëŠ” ì¤‘ì´ë©´ íŒ¨ìŠ¤

      s.textContent = stripLabelsInline(ov.summary || '');

      const doms = ov.domains || {};
      const body = (stripLabelsInDetail(ov.detail || '') + '\n\n'
        + 'Â· ì—°ì• : ' + (doms['ì—°ì• '] || '') + '\n'
        + 'Â· ì‚¬ì—…: ' + (doms['ì‚¬ì—…'] || '') + '\n'
        + 'Â· ê³µë¶€: ' + (doms['ê³µë¶€'] || '') + '\n'
        + 'Â· ê±´ê°•: ' + (doms['ê±´ê°•'] || '')).trim();

      d.replaceChildren();
      body.split(/\n+/).filter(Boolean).forEach(p=>{
        const el=document.createElement('p'); el.textContent=p; d.appendChild(el);
      });
    });
  }catch(e){ console.warn(e); }
}

/******** ëœë”©: ì»¤ìŠ¤í…€ ì„ íƒ & ë¯¸ë¦¬ë³´ê¸° ********/
const OPTS=[{v:'',t:'ì„ íƒ'},{v:6,t:'ë…¸ìŒ'},{v:7,t:'ì†Œì–‘'},{v:8,t:'ì†ŒìŒ'},{v:9,t:'ë…¸ì–‘'}];
const vals=[null,null,null,null,null,null]; // bottomâ†’top index(0..5)
function drawPreviewBase(base,changed,unsetMask){
  const hexBox=document.getElementById('prevBaseHex'); if(!hexBox) return; hexBox.innerHTML='';
  for(var r=5;r>=0;r--){
    var lab=document.createElement('div'); lab.className='lab'; lab.textContent=(r+1);
    var cls= unsetMask[r] ? 'unset' : (base[r]?'yang':'yin') + (changed[r]?' chg':'');
    var wrap=document.createElement('div'); wrap.className='lineWrap '+cls;
    var line=document.createElement('div'); line.className='line'; wrap.appendChild(line);
    if(!unsetMask[r] && !base[r]){ var gap=document.createElement('div'); gap.className='gap'; wrap.appendChild(gap); }
    hexBox.appendChild(lab); hexBox.appendChild(wrap); var sp=document.createElement('div'); sp.className='sp'; hexBox.appendChild(sp);
  }
}
function live(){
  const base=[],changed=[],unsetMask=[];
  for(let i=0;i<6;i++){
    const v=vals[i];
    if(v===null){ base.push(1); changed.push(false); unsetMask.push(true); }
    else{ const ch=(v===6||v===9), ln=(v===7||v===9)?1:0; base.push(ln); changed.push(ch); unsetMask.push(false); }
  }
  drawPreviewBase(base,changed,unsetMask);
}
function wireSelects(){
  const selects=document.querySelectorAll('#selCol select');
  selects.forEach(sel=>{
    const i=parseInt(sel.getAttribute('data-idx'),10);
    vals[i]= sel.value==='' ? null : parseInt(sel.value,10);
    sel.addEventListener('change',e=>{
      const vv=e.target.value; vals[i]=(vv===''?null:parseInt(vv,10));
      live(); if(vals.every(v=>v!==null)) document.getElementById('msg').classList.add('hidden');
    });
  });
}

/******** ì œì¶œ ë° ì‹¤í–‰ ********/
function submitRun(){
  const msg=document.getElementById('msg');
  if(vals.some(v=>v===null)){ msg.classList.remove('hidden'); msg.scrollIntoView({behavior:'smooth',block:'center'}); return; }
  const base=[],changed=[],vv=[];
  for(let i=0;i<6;i++){ const v=vals[i]; vv.push(v); const ch=(v===6||v===9), ln=(v===7||v===9)?1:0; base.push(ln); changed.push(ch); }
  const mutated=base.map((l,i)=> changed[i] ? (l^1) : l);

  document.getElementById('landingUI')?.classList.add('hidden');
  document.getElementById('result')?.classList.remove('hidden');

  const b=lookup(base), m=lookup(mutated);
  
  animateBothAllAtOnce(base, mutated, changed, vv, b, m);
//  requestAI({ method:'custom', question:(document.getElementById('q').value||'').trim(), values:vv, base:b, mutated:m, changed:changed });
}
document.getElementById('btnRun').addEventListener('click', submitRun);

/******** AI ì—°ë™ ********/
async function requestAI(payload){
  const st=document.getElementById('aiStatus');
  const out=document.getElementById('aiOut');
  st.textContent='ì§ˆë¬¸ê³¼ ì ê´˜ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìƒì„± ì¤‘â€¦'; out.textContent='';

  if(typeof window.aiRequest==='function'){
    try{
      const r=await window.aiRequest(payload);
      const txt=normalizeAI(r);
      st.textContent='ì™„ë£Œ'; out.textContent=(txt||'').trim(); return;
    }catch(e){ log('aiRequest failed:', e && e.message ? e.message : e); st.textContent='ë‚´ì¥ í›„í¬ ì‹¤íŒ¨. í´ë°± ì‹œë„â€¦'; }
  }

  try{
    const res=await fetch('/api/iching/interpret',{ method:'POST', headers:{'Content-Type':'application/json','Accept':'application/json'}, body:JSON.stringify(payload) });
    const ct=(res.headers.get('content-type')||'').toLowerCase();
    if(!res.ok){
      const errBody=ct.includes('application/json') ? JSON.stringify(await res.json()) : (await res.text());
      throw new Error('HTTP '+res.status+' '+res.statusText+' â€” '+errBody.slice(0,300));
    }
    if(ct.includes('application/json')){
      const data=await res.json(); const txt=normalizeAI(data);
      st.textContent='ì™„ë£Œ'; out.textContent=(txt||'').trim();
    }else{
      const text=await res.text();
      st.textContent='ì„œë²„ê°€ JSONì´ ì•„ë‹Œ ì‘ë‹µì„ ë³´ëƒˆì–´';
      out.textContent=(text||'').slice(0,400)+((text||'').length>400?'\nâ€¦':'')+'\n\nâ€» /api/iching/interpret ë¼ìš°íŠ¸ê°€ SPA index.html ë˜ëŠ” 404 HTMLì„ ë°˜í™˜í•˜ê³  ìˆì–´. ë°±ì—”ë“œì—ì„œ JSONì„ ë°˜í™˜í•˜ë„ë¡ ì—°ê²°í•´ì¤˜.';
    }
  }catch(e){
    st.textContent='AI í˜¸ì¶œ ì‹¤íŒ¨';
    out.textContent='ìš”ì²­ ì‹¤íŒ¨: '+(e && e.message ? e.message : e)+'\n\nâ€¢ ì›ì¸: ì—”ë“œí¬ì¸íŠ¸ê°€ JSONì„ ëŒë ¤ì£¼ì§€ ì•ŠìŒ(ëŒ€ê°œ 404/ë¦¬ë‹¤ì´ë ‰íŠ¸/SPA HTML).\nâ€¢ í•´ê²°:\n  1) window.aiRequest(payload) ì „ì—­ í›„í¬ êµ¬í˜„, ë˜ëŠ”\n  2) /api/iching/interpret ê°€ JSON {text:string} ë¥¼ ë°˜í™˜í•˜ë„ë¡ ë°±ì—”ë“œ ë¼ìš°íŒ….';
    log('fallback error detail', e && (e.stack || e.message));
  }

  function normalizeAI(x){
    if(typeof x==='string') return x;
    if(!x) return '';
    if(x.text) return x.text;
    if(x.message) return x.message;
    try{
      if(Array.isArray(x.choices) && x.choices[0]){
        const c=x.choices[0];
        if(c.message && c.message.content) return c.message.content;
        if(c.text) return c.text;
      }
    }catch(_){}
    return typeof x==='object'? JSON.stringify(x): String(x);
  }
}
  
/******** ì´ˆê¸°í™” ********/
window.addEventListener('DOMContentLoaded', ()=>{ try{ wireSelects(); live(); } catch(e){ log('init error', e && (e.message||e)); }});

function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }

/** ì»¤ìŠ¤í…€ìš©: ì—¬ì„¯ íš¨ë¥¼ 'ë™ì‹œì—' ê³µê°œ */
async function animateBothAllAtOnce(base, mutated, changed, vals, bInfo, mInfo, delay=500){
  const baseHex  = document.getElementById('baseHex');
  const mutHex   = document.getElementById('mutHex');
  const baseCard = document.getElementById('cardBase');
  const mutCard  = document.getElementById('cardMut');
  const joint    = document.querySelector('.joint');

  // í…ìŠ¤íŠ¸/ë¼ì¸ ì¤€ë¹„: ìˆ¨ê¹€ ìƒíƒœ ì„¸íŒ…
  baseHex?.classList.add('animating');
  mutHex?.classList.add('animating');
  baseCard?.classList.add('prehide','animating');
  mutCard?.classList.add('prehide','animating');
  joint?.classList.add('prehide','animating');

  // ì „í™˜ ë³µêµ¬(ë‹¤ìŒ í”„ë ˆì„ë¶€í„° íŠ¸ëœì§€ì…˜ í™œì„±)
  requestAnimationFrame(()=>{
    baseCard?.classList.remove('prehide');
    mutCard?.classList.remove('prehide');
    joint?.classList.remove('prehide');
  });

  // ë‘˜ ë‹¤ ë¨¼ì € ë Œë”(í…ìŠ¤íŠ¸ëŠ” ì•„ì§ ê°€ë¦¼)
  render('base', base,    changed, vals, bInfo);
  render('mut',  mutated, changed, vals, mInfo);

  // ë¼ì¸ë“¤ ì´ˆê¸°í™” â†’ ë™ì‹œì— ê³µê°œ
  const baseWraps = Array.from(baseHex.querySelectorAll('.lineWrap'));
  const mutWraps  = Array.from(mutHex.querySelectorAll('.lineWrap'));
  baseWraps.forEach(w=>w.classList.remove('revealed'));
  mutWraps.forEach(w=>w.classList.remove('revealed'));

  await sleep(10);                    // í•œ í‹± ëŒ€ê¸°(transition ì ìš©)
  baseWraps.forEach(w=>w.classList.add('revealed'));
  mutWraps.forEach(w=>w.classList.add('revealed'));

  await sleep(delay + 150);           // ë¼ì¸ â€˜íˆ­â€™ ë“±ì¥ ì‹œê°„ë§Œí¼ ê¸°ë‹¤ë¦¼

  // ë¼ì¸ ì• ë‹ˆ ì¢…ë£Œ â†’ ì¹´ë“œ í…ìŠ¤íŠ¸/ê³µìœ í•´ì„ ì¼ê´„ ë“±ì¥
  baseHex?.classList.remove('animating');
  mutHex?.classList.remove('animating');
  baseCard?.classList.remove('animating');
  mutCard?.classList.remove('animating');

  // ê³µìœ  í•´ì„ ì±„ìš°ê³  "ë¾°ë¡œë¡±"
  renderJoint(base, mutated, changed, vals, bInfo, mInfo);
  requestAnimationFrame(()=> joint?.classList.remove('animating'));
}

  // --- AI augment (wrap renderJoint) : coins ë°©ì‹ ê·¸ëŒ€ë¡œ ---
(function(){
  let ctrl = 0;
  async function aiAugment(payload){
    const my = ++ctrl;
    const j = document.getElementById('jointBox');
    const s = document.getElementById('jointSummary');
    const d = document.getElementById('jointText');
    if(!j || !d) return;
    j.classList.add('ai-owned','loading');
    d.replaceChildren();
        
    const loader = document.createElement('div');
    loader.className = 'loader';
        
    loader.innerHTML = `
  <svg viewBox="0 0 512 512" width="45" height="45" aria-hidden="true">
    <!-- ë°”ê¹¥ ì‚¬ê°í˜• -->
    <g class="sq-outer" fill="#E7EEFC">
      <path class="st0" d="M461.19,258.83l-86.11,86.11c-1.56,1.56-1.56,4.09,0,5.66l12.7,12.7c1.56,1.56,4.09,1.56,5.66,0l104.47-104.47c1.56-1.56,1.56-4.09,0-5.66l-104.47-104.47c-1.56-1.56-4.09-1.56-5.66,0l-12.7,12.7c-1.56,1.56-1.56,4.09,0,5.66l86.11,86.11c1.56,1.56,1.56,4.09,0,5.66h0Z"/>
      <path class="st0" d="M253.17,14.11L14.11,253.17c-1.56,1.56-1.56,4.09,0,5.66l239.07,239.07c1.56,1.56,4.09,1.56,5.66,0l104.47-104.47c1.56-1.56,1.56-4.09,0-5.66l-12.7-12.7c-1.56-1.56-4.09-1.56-5.66,0l-86.11,86.11c-1.56,1.56-4.09,1.56-5.66,0L50.81,258.83c-1.56-1.56-1.56-4.09,0-5.66L253.17,50.81c1.56-1.56,4.09-1.56,5.66,0l86.11,86.11c1.56,1.56,4.09,1.56,5.66,0l12.7-12.7c1.56-1.56,1.56-4.09,0-5.66L258.83,14.11c-1.56-1.56-4.09-1.56-5.66,0h0Z"/>
    </g>

    <!-- ì¤‘ê°„ ì‚¬ê°í˜• -->
    <g class="sq-mid" fill="#E7EEFC">
      <path class="st0" d="M191.99,344.48l-12.7,12.7c-1.56,1.56-1.56,4.09,0,5.66l73.88,73.88c1.56,1.56,4.09,1.56,5.66,0l73.88-73.88c1.56-1.56,1.56-4.09,0-5.66l-12.7-12.7c-1.56-1.56-4.09-1.56-5.66,0l-55.52,55.52c-1.56,1.56-4.09,1.56-5.66,0l-55.52-55.52c-1.56-1.56-4.09-1.56-5.66,0Z"/>
      <path class="st0" d="M344.48,320.01l12.7,12.7c1.56,1.56,4.09,1.56,5.66,0l73.88-73.88c1.56-1.56,1.56-4.09,0-5.66l-177.89-177.89c-1.56-1.56-4.09-1.56-5.66,0L75.29,253.17c-1.56,1.56-1.56,4.09,0,5.66l73.88,73.88c1.56,1.56,4.09,1.56,5.66,0l12.7-12.7c1.56-1.56,1.56-4.09,0-5.66l-55.52-55.52c-1.56-1.56-1.56-4.09,0-5.66L253.17,111.99c1.56-1.56,4.09-1.56,5.66,0l141.18,141.18c1.56,1.56,1.56,4.09,0,5.66l-55.52,55.52c-1.56,1.56-1.56,4.09,0,5.66h0Z"/>
    </g>

    <!-- ì•ˆìª½ ì‚¬ê°í˜• -->
    <g class="sq-inner" fill="#E7EEFC">
      <path class="st0" d="M302.12,179.75l-43.29-43.29c-1.56-1.56-4.09-1.56-5.66,0l-116.7,116.7c-1.56,1.56-1.56,4.09,0,5.66l116.7,116.7c1.56,1.56,4.09,1.56,5.66,0l43.29-43.29c1.56-1.56,1.56-4.09,0-5.66l-12.7-12.7c-1.56-1.56-4.09-1.56-5.66,0l-24.93,24.93c-1.56,1.56-4.09,1.56-5.66,0l-80-80c-1.56-1.56-1.56-4.09,0-5.66l80-80c1.56-1.56,4.09-1.56,5.66,0l24.93,24.93c1.56,1.56,4.09,1.56,5.66,0l12.7-12.7c1.56-1.56,1.56-4.09,0-5.66v.04Z"/>
      <path class="st0" d="M338.82,258.83l-24.93,24.93c-1.56,1.56-1.56,4.09,0,5.66l12.7,12.7c1.56,1.56,4.09,1.56,5.66,0l43.29-43.29c1.56-1.56,1.56-4.09,0-5.66l-43.29-43.29c-1.56-1.56-4.09-1.56-5.66,0l-12.7,12.7c-1.56,1.56-1.56,4.09,0,5.66l24.93,24.93c1.56,1.56,1.56,4.09,0,5.66Z"/>
    </g>
  </svg>
          `;
    d.appendChild(loader);
    s.textContent = 'AIì˜ ë§ì¶¤í˜• í•´ì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.';

    // âœ… ëˆ„ì  íšŒì „ ë£¨í”„ (ê°ì ë‹¤ë¥¸ ê°ë„/ì†ë„/íœ´ì‹/ì‹œì‘ì§€ì—°)
    const ease = 'cubic-bezier(.32,.02,.24,1)';
    const sleep = ms => new Promise(r=>setTimeout(r, ms));
    const alive = () => loader.isConnected && my===ctrl;

    async function spinLoop(el, step, spin, hold, delay){
      if(!el) return;
      if(delay) await sleep(delay);
      let angle = 0;
      while(alive()){
        el.style.transition = `transform ${spin}ms ${ease}`;
        angle += step;                          // ëˆ„ì  íšŒì „
        el.style.transform = `rotate(${angle}deg)`;
        await sleep(spin);
        if(!alive()) break;
        await sleep(hold);                      // ë©ˆì¶¤ êµ¬ê°„
      }
    }  

    // ë„¤ê°€ ë§ì¶°ë‘” ê°’ ê·¸ëŒ€ë¡œ ì‚¬ìš©(ì˜ˆ: 270/180/360)
    spinLoop(loader.querySelector('.sq-outer'), 180,  800, 600, 1000);
    spinLoop(loader.querySelector('.sq-mid')  , 270, 1100, 300,  650);
    spinLoop(loader.querySelector('.sq-inner'), 360,  900, 500,  500); 
    
    try{
      // ë™ì „ë²•ê³¼ ë™ì¼ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©
      const res = await fetch('https://iching-ai-ilo2.onrender.com/api/read', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      });
      if(my!==ctrl) return;                 // ìµœì‹  ìš”ì²­ë§Œ ë°˜ì˜
      if(!res.ok) throw new Error('HTTP '+res.status);

      const data = await res.json() || {};
      const reading  = data.reading || {};
      let summary    = (reading.summary || '').trim();
      let analysis   = (reading.analysis || '').trim();
      let advice     = (reading.advice || '').trim();
      let cautions   = (reading.cautions || '').trim();

      // ë³¸ë¬¸ ì•ì— ìš”ì•½ì´ ì¤‘ë³µë˜ë©´ ì œê±°
      function stripLead(t){ return (summary && t.startsWith(summary)) ? t.slice(summary.length).trim() : t; }
      analysis = stripLead(analysis); advice = stripLead(advice);

      // ë¬¸ë‹¨ ì¤‘ë³µ ì œê±°(ë™ì „ë²•ê³¼ ë™ì¼)
      function dedupeParas(t){
        const paras = (t||'').split(/\n+/).map(s=>s.trim()).filter(Boolean);
        return paras.filter((p,i,a)=> a.indexOf(p)===i).join('\n\n');
      }
      analysis = dedupeParas(analysis);
      advice   = dedupeParas(advice);
      cautions = dedupeParas(cautions);

      // í™”ë©´ ë°˜ì˜
      s.textContent = summary || 'ìš”ì•½ ì—†ìŒ';
      const parts = [];
      if (analysis) parts.push(analysis);
      if (advice)   parts.push('ì¡°ì–¸:\n' + advice);
      if (cautions) parts.push('ì£¼ì˜:\n' + cautions);
      if (Array.isArray(reading.line_readings) && reading.line_readings.length){
        const lines = reading.line_readings.map(x => `[${x.line}íš¨] ${x.meaning}`).join('\n');
        parts.push(lines);
      }
      if (reading.timing) parts.push('íƒ€ì´ë°: ' + reading.timing);
      if (typeof reading.score === 'number') parts.push(`ê¸¸í‰ ì ìˆ˜: ${reading.score}/10`);
      d.textContent = parts.join('\n\n');

      // ë¡œë” í•´ì œ
      j.classList.remove('loading');

    }catch(e){
      if(my!==ctrl) return;
      console.warn('AI enrich fail', e);
      s.textContent = 'í•´ì„ ìƒì„± ì‹¤íŒ¨';
      j.classList.remove('loading');
      d.textContent = 'AI ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆì–´ìš”. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
    }
  }

  // renderJoint ëë‚œ ë‹¤ìŒ AI ì‹¤í–‰í•˜ë„ë¡ ë˜í•‘
  if (typeof renderJoint === 'function'){
    const orig = renderJoint;
    renderJoint = function(base, mutated, changed, vals, bInfo, mInfo){
      // ê¸°ë³¸(ë‚´ì¥) í•´ì„ ë¨¼ì € ë Œë”
      orig(base, mutated, changed, vals, bInfo, mInfo);

      // ì§ˆë¬¸ ì—†ìœ¼ë©´ AI ìƒëµ (ë™ì „ë²•ê³¼ ë™ì¼ ì •ì±…)
      const q = (document.getElementById('userQuestion')?.value || '').trim();
      if(!q) return;

      const changingLines = changed.map((v,i)=> v ? (i+1) : null).filter(Boolean);
      const payload = {
        question: q,
        method: 'custom',
        primary:  { number: bInfo.no, name_han: bInfo.nameHan, name_kr: bInfo.nameKo, pattern: '' },
        relating: { number: mInfo.no, name_han: mInfo.nameHan, name_kr: mInfo.nameKo, pattern: '' },
        changingLines
      };
      aiAugment(payload);
    };
  }
})();

document.addEventListener('DOMContentLoaded', () => {
  const items = [
    ...document.querySelectorAll('.js-reveal') /*,
    ...document.querySelectorAll('[data-reveal-group] > *') */
  ];

  const reduce = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const baseDelay = 800;  // í—¤ë”ë§Œ ë¨¼ì € ë³´ì´ê²Œ ì ê¹ ëŒ€ê¸°
  const step = 200;       // í•­ëª© ê°„ ì§€ì—°(ms) â€” ì·¨í–¥ê» 120~240 ì‚¬ì´ë¡œ ì¡°ì ˆ

  items.forEach((el, i) => {
    const delay = baseDelay + i * step;
    setTimeout(() => {
      // reflowë¡œ ì²« í”„ë ˆì„ í™•ì‹¤íˆ ê³ ì •
      void el.offsetWidth;
      el.classList.add('show');  // reduceì—¬ë„ ìˆœì°¨ ë“±ì¥(ì• ë‹ˆ ì—†ìŒ)
    }, delay);
  });
});
  
</script>
</body>
</html>
